<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browse Photos</title>
    <Link rel="stylesheet" href="main.css"></Link>
  </head>
  <header id="header">
      <h2>Photography Gallery</h2>
    </header>
  <body>
    <div id="photoContainer"></div>

    <div id="photoContainer"></div>
    
    <div class="modal" id="photoModal">
      <span class="close" id="closeModal">&times;</span>
      <img id="modalImg" alt="Enlarged Photo" />
    </div>
    
    <script>

      let username = localStorage.getItem("username");
      let sessionKey = localStorage.getItem("sessionKey");

      if (!username){
        linktologin = document.createElement("a");
        linktologin.textContent = "login";
        linktologin.href = "login.html";
        linktoregister = document.createElement("a");
        linktoregister.textContent = "create an account"
        linktoregister.href = "register.html";
        document.body.appendChild(linktologin);
        document.body.appendChild(linktoregister);
      }

      if (username){
        let header = document.getElementById("header");
        let usernameDisplay = document.createElement("h3");
        usernameDisplay.textContent = username;
        logout = document.createElement("button");
        logout.textContent ="logout";
        logout.id = "logout";
        logout.addEventListener("click", (event) => {
          localStorage.removeItem('username');
          localStorage.removeItem('sessionkey');
          window.location.reload();
        })
        header.appendChild(usernameDisplay);
        header.appendChild(logout);
        linktoupload = document.createElement("a");
        linktoupload.textContent = "Upload a photo";
        linktoupload.href = "upload.html";
        document.body.appendChild(linktoupload);
      }

      const photoContainer = document.getElementById("photoContainer");

      const modal = document.getElementById('photoModal');
      const modalImg = document.getElementById('modalImg');
      const closeModal = document.getElementById('closeModal');      

      // some of these will be none, before enough people add to the website, there will not be
      // 10 photos so we need to account for that
      // as well when someone deletes a photo that id remains taken in the sql database
      // probably do a while loop that iterates until 20 images are rendered with a failsafe
      // incase their arnt enough images

      for (let i = 1; i < 10; i++) {
        fetch(`http://localhost:3000/getPhoto?id=${i}`)
          .then((response) => {
            if (response.status === 200) {
              return response.json();
            } else {
              return None;
            }
          })
          .then((data) => {
            if (data) {
              const artworkDiv = document.createElement("div");
              artworkDiv.style.textAlign = "center"; // Center text alignment
              artworkDiv.style.width = "200px";

              const img = document.createElement("img");
              img.src = `data:image/jpeg;base64,${data.photoData}`;
              img.classList.add("photo");

              img.addEventListener("click", () => {
                modal.style.display = "flex";
                modalImg.src = img.src;
              });

              const title = document.createElement("p");
              title.textContent = `Title: ${data.title}`;

              const artist = document.createElement("p");
              artist.textContent = `Artist: ${data.author}`;

              const description = document.createElement("p");
              description.textContent = `description: ${data.description}`;


              artworkDiv.appendChild(img);
              artworkDiv.appendChild(title);
              artworkDiv.appendChild(artist);
              artworkDiv.appendChild(description);

              photoContainer.appendChild(artworkDiv);



            } else {
              console.error("No photo data received");
            }
          })
          .catch((error) => {
            console.error("Error fetching photo:", error);
          });
      }

      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });
      
    </script>
  </body>
</html>
